function e(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function t(t,n,i){return(n=e(n))in t?Object.defineProperty(t,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[n]=i,t}const n="http://www.w3.org/2000/svg";class i{constructor(e,i,s,o,r){t(this,"_joinSucceeded",!1),t(this,"_joinFailed",!1),t(this,"selectVendor",(e=>{this._selectedVendor=e,this.renderJoinContents()})),t(this,"unselectVendor",(()=>{this._selectedVendor=void 0,this._joinFailed=!1,this.renderJoinContents()})),t(this,"fetchVendorList",(async()=>{const e=new URL(this._derapiApiUrl+"/join/session/".concat(this._sessionToken,"/vendors"),this._derapiApiUrl),t=new Headers;t.append("Authorization","Bearer ".concat(this._derapiToken)),t.append("Content-Type","application/json"),t.append("api-version","v2024-09-01");const n=await fetch(e.toString(),{method:"GET",headers:t});return await n.json()})),t(this,"setSuccess",(()=>{this._joinSucceeded=!0,this.renderJoinContents(),this._onSuccess()})),t(this,"setFailure",(()=>{this._joinFailed=!0,this.renderJoinContents()})),t(this,"createCloseButton",(()=>{const e=document.createElement("div");e.style.width="100%",e.style.height="24px",e.style.display="flex",e.style.flexDirection="row",e.style.justifyContent="end";const t=document.createElementNS(n,"svg");t.style.width="24px",t.style.height="24px",t.setAttribute("viewBox","0 0 24 24"),t.addEventListener("click",(()=>{this.close()}));const i=document.createElementNS(n,"path");return i.setAttribute("d","M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"),t.appendChild(i),e.appendChild(t),e})),t(this,"createJoinTitle",(()=>{const e=document.createElement("div");e.style.display="flex",e.style.flexDirection="column",e.style.alignItems="center";const t=this.createCloseButton();e.appendChild(t);const n=document.createElement("div");n.style.fontSize="1.2em",n.style.fontWeight="700",n.innerText="Derapi Join";const i=document.createElement("div");return i.innerText="Select your provider from the list below",e.appendChild(n),e.appendChild(i),e})),t(this,"createVendorList",(e=>{const t=[];return e.map((e=>{const n=document.createElement("div");n.style.display="flex",n.style.flexDirection="column",n.style.alignItems="center",n.style.gap=".1em",n.style.marginTop=".3em";const i=document.createElement("hr");i.style.width="100%",i.style.backgroundColor="rgba(0, 0, 0, 0.2)",i.style.borderColor="rgba(0, 0, 0, 0.2)",n.appendChild(i);const s=document.createElement("button");s.style.borderStyle="none",s.style.backgroundColor="transparent",s.addEventListener("click",(()=>{this.selectVendor(e)}));const o=document.createElement("img");o.src=e.base64Logo,s.appendChild(o),n.appendChild(s),t.push(n)})),t})),t(this,"createOAuthView",(e=>{const t=document.createElement("div");t.textContent="Redirecting to ".concat(e.name," to join your account.");const n=e.oAuthEndpoint,i=async()=>{const e=new URL(this._derapiApiUrl+"/join/session/".concat(this._sessionToken,"/fetch-token"),this._derapiApiUrl),t=new Headers;t.append("Authorization","Bearer ".concat(this._derapiToken)),t.append("Content-Type","application/json"),t.append("api-version","v2024-09-01");const n=await fetch(e.toString(),{method:"GET",headers:t});if(!(await n.json()).access_token)throw new Error("failed to create token")},s=()=>{i().then((()=>{this.setSuccess()})).catch((()=>{this.setFailure()}))},o=window.open(n,"*","popup");if(o)var r=setInterval((function(){o.closed&&(clearInterval(r),s())}),1e3);return t})),t(this,"createGreyCircle",(()=>{const e=document.createElement("div");e.style.height="24px",e.style.width="24px";const t=document.createElementNS(n,"svg");t.setAttribute("width","24"),t.setAttribute("height","24"),t.setAttribute("fill","none"),t.setAttribute("viewBox","0 0 24 24"),t.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink");const i=document.createElementNS(n,"circle");return i.setAttribute("cx","12"),i.setAttribute("cy","12"),i.setAttribute("r","12"),i.setAttribute("fill","#D9D9D9"),t.appendChild(i),e.appendChild(t),e})),t(this,"createCustomOAuthView",(e=>{const t=document.createElement("div");t.style.display="flex",t.style.flexDirection="column",t.style.alignItems="center",t.style.gap="1.2em";const n=document.createElement("img");if(n.src=e.base64Logo,t.appendChild(n),"solaredge"==e.id){const e=document.createElement("div");e.style.display="flex",e.style.flexDirection="column",e.style.alignItems="left",e.style.marginLeft="2em",e.style.marginRight="2em",e.style.gap="1em";const n=document.createElement("div");n.style.display="flex",n.style.flexDirection="row",n.style.gap="1em";const i=this.createGreyCircle(),s=document.createElement("span");s.innerHTML="Access the SolarEdge Monitoring site <a href='https://monitoring.solaredge.com/' target='_blank' rel='noopener noreferrer'>monitoring.solaredge.com</a>",n.appendChild(i),n.appendChild(s),e.appendChild(n);const o=document.createElement("div");o.style.display="flex",o.style.flexDirection="row",o.style.gap="1em";const r=this.createGreyCircle(),l=document.createElement("span");l.innerHTML="Navigate to Admin &#8594; Site Access &#8594; Access Control",o.appendChild(r),o.appendChild(l),e.appendChild(o);const a=document.createElement("div");a.style.display="flex",a.style.flexDirection="row",a.style.gap="1em";const d=this.createGreyCircle(),c=document.createElement("span");c.innerText="Agree to the T&Cs, then generate and save the API Key",a.appendChild(d),a.appendChild(c),e.appendChild(a);const p=document.createElement("div");p.style.display="flex",p.style.flexDirection="row",p.style.gap="1em";const h=this.createGreyCircle(),m=document.createElement("span");m.innerText="Copy and Paste below",p.appendChild(h),p.appendChild(m),e.appendChild(p),t.appendChild(e)}if("solis"==e.id){const e=document.createElement("div");e.style.display="flex",e.style.flexDirection="column",e.style.alignItems="left",e.style.marginLeft="2em",e.style.marginRight="2em",e.style.gap="1em";const n=document.createElement("div");n.style.display="flex",n.style.flexDirection="row",n.style.gap="1em";const i=this.createGreyCircle(),s=document.createElement("div");s.style.display="flex",s.style.flexDirection="column";const o=document.createElement("span");o.innerHTML="API access requires activation via <a href='https://solis-service.solisinverters.com/en/support/solutions/articles/44002212561-api-access-soliscloud' target='_blank' rel='noopener noreferrer'>Solis Support</a>. Complete this first.",s.appendChild(o),n.appendChild(i),n.appendChild(s),e.appendChild(n);const r=document.createElement("div");r.style.display="flex",r.style.flexDirection="row",r.style.gap="1em";const l=this.createGreyCircle(),a=document.createElement("span");a.innerHTML="Access the Solis Cloud portal <a href='https://soliscloud.com' target='_blank' rel='noopener noreferrer'>soliscloud.com</a>",r.appendChild(l),r.appendChild(a),e.appendChild(r);const d=document.createElement("div");d.style.display="flex",d.style.flexDirection="row",d.style.gap="1em";const c=this.createGreyCircle(),p=document.createElement("span");p.innerHTML="Navigate to Service &#8594; API Management &#8594; Verification Code",d.appendChild(c),d.appendChild(p),e.appendChild(d);const h=document.createElement("div");h.style.display="flex",h.style.flexDirection="row",h.style.gap="1em";const m=this.createGreyCircle(),u=document.createElement("span");u.innerText="Copy API ID and API Secret and Paste below",h.appendChild(m),h.appendChild(u),e.appendChild(h),t.appendChild(e)}const i=document.createElement("div");i.style.display="flex",i.style.flexDirection="column",i.style.alignItems="left",i.style.gap=".2em";const s=document.createElement("label");s.setAttribute("for","derapi-join-username-input"),s.style.color="rgba(0, 0, 0, 0.6)",s.style.marginLeft=".2em",s.textContent="API Key ID",i.appendChild(s);const o=document.createElement("input");o.setAttribute("type","text"),o.style.borderRadius="4px",o.style.padding=".5em",o.id="derapi-join-username-input",i.appendChild(o),t.appendChild(i);const r=document.createElement("div");let l;if(r.style.display="flex",r.style.flexDirection="column",r.style.alignItems="left",r.style.gap=".2em","solaredge"!=e.id){const e=document.createElement("label");e.setAttribute("for","derapi-join-password-input"),e.style.color="rgba(0, 0, 0, 0.6)",e.style.marginLeft=".2em",e.textContent="API Key Secret",r.appendChild(e),l=document.createElement("input"),l.setAttribute("type","password"),l.style.borderRadius="4px",l.style.padding=".5em",l.id="derapi-join-password-input",r.appendChild(l),t.appendChild(r)}const a=document.createElement("button");a.style.borderRadius="4px",a.style.backgroundColor="#FFA62B",a.style.boxShadow="rgba(0, 0, 0, 0.2) 0px 3px 1px -2px, rgba(0, 0, 0, 0.14) 0px 2px 2px 0px, rgba(0, 0, 0, 0.12) 0px 1px 5px 0px",a.style.borderStyle="none",a.style.color="white",a.style.padding=".5em",a.style.paddingRight="1em",a.style.paddingLeft="1em",a.style.minWidth="100px",a.textContent="JOIN";const d=(e,t,n)=>{a.disabled=!0,a.style.opacity=".5",c(e,t,n).then((()=>{this.setSuccess()})).catch((()=>{this.setFailure()}))},c=async(e,t,n)=>{const i="".concat(t,":").concat(n),s=new URL(this._derapiApiUrl+"/join/".concat(e.id,"/auth-granted?state=").concat(this._sessionToken,"&code=").concat(i),this._derapiApiUrl),o=new Headers,r=await fetch(s.toString(),{method:"GET",headers:o});if(!r.ok)throw new Error("custom oAuth failed: ".concat(r.status));if((await r.text()).includes("failed"))throw new Error("custom oAuth failed")};return a.addEventListener("click",(()=>{const t=o.value,n=l?l.value:"";d(e,t,n)})),o.addEventListener("keydown",(t=>{if("Enter"==t.key){const t=o.value,n=l?l.value:"";d(e,t,n)}})),l&&l.addEventListener("keydown",(t=>{if("Enter"==t.key){const t=o.value,n=l?l.value:"";d(e,t,n)}})),t.appendChild(a),t})),t(this,"createLoadingSpinner",(()=>{const e=document.createElement("div");e.style.width="50px",e.style.height="50px",e.style.margin="2em";const t=document.createElement("span");t.style.display="block",t.style.width="50px",t.style.height="50px",t.style.color="#34aeeb";const i=document.createElementNS(n,"svg");i.style.display="block",i.setAttribute("viewBox","22 22 44 44"),i.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink");const s=document.createElementNS(n,"circle");s.setAttribute("cx","44"),s.setAttribute("cy","44"),s.setAttribute("r","20.2"),s.setAttribute("fill","none"),s.setAttribute("stroke","#34aeeb"),s.setAttribute("stroke-width","3.6"),s.setAttribute("stroke-dasharray",".5"),s.setAttribute("pathLength","1");const o=document.createElementNS(n,"animate");return o.setAttribute("attributeName","stroke-dashoffset"),o.setAttribute("values","0;.33;.66;1;"),o.setAttribute("repeatCount","indefinite"),o.setAttribute("dur","1s"),s.appendChild(o),i.appendChild(s),t.appendChild(i),e.appendChild(t),e})),t(this,"createBackButton",(()=>{const e=document.createElement("div");e.style.width="100%",e.style.display="flex",e.style.flexDirection="row",e.style.justifyContent="start",e.style.alignItems="center",e.style.gap="1em",e.style.marginBottom="1.5em";const t=document.createElementNS(n,"svg");t.style.width="24px",t.style.height="24px",t.setAttribute("viewBox","0 0 24 24"),t.addEventListener("click",(()=>{this.unselectVendor()}));const i=document.createElementNS(n,"path");i.setAttribute("d","M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"),t.appendChild(i),e.appendChild(t);const s=document.createElement("div");return s.style.fontSize=".8em",s.textContent="Back to Vendor Selection",e.appendChild(s),e})),t(this,"createSuccessView",(()=>{var e;const t=document.createElement("div");t.style.display="flex",t.style.flexDirection="column",t.style.alignItems="center",t.style.gap="1em";const i=this.createCloseButton();t.appendChild(i);const s=document.createElementNS(n,"svg");s.style.color="rgb(0, 128, 0)",s.style.fill="rgb(0, 128, 0)",s.style.width="140px",s.style.height="140px",s.setAttribute("viewBox","0 0 24 24");const o=document.createElementNS(n,"path");o.style.color="rgb(0, 128, 0)",o.style.fill="rgb(0, 128, 0)",o.setAttribute("d","M16.59 7.58 10 14.17l-3.59-3.58L5 12l5 5 8-8zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"),s.appendChild(o),t.appendChild(s);const r=document.createElement("div");return r.innerText="Thank you for linking your ".concat(null===(e=this._selectedVendor)||void 0===e?void 0:e.name," account."),t.appendChild(r),t})),t(this,"createFailedView",(()=>{var e;const t=document.createElement("div");t.style.display="flex",t.style.flexDirection="column",t.style.gap=".5em";const n=this.createBackButton();t.appendChild(n);const i=document.createElement("div");return i.style.color="#FF6A6A",i.textContent="Failed to Join your ".concat(null===(e=this._selectedVendor)||void 0===e?void 0:e.name," account."),t.appendChild(i),t})),t(this,"renderSelectedVendor",(()=>{if(this._selectedVendor&&this._root){const e=this.createBackButton();if(this._root.appendChild(e),this._selectedVendor.oAuthEndpoint){const e=this.createOAuthView(this._selectedVendor);this._root.appendChild(e)}else{const e=this.createCustomOAuthView(this._selectedVendor);this._root.appendChild(e)}}})),t(this,"renderJoinContents",(()=>{if(this._root||this.renderAndOpenModal(),!this._root)throw new Error("missing join dialog");if(this._root.textContent="",this._joinSucceeded){const e=this.createSuccessView();this._root.appendChild(e)}else if(this._joinFailed){const e=this.createFailedView();this._root&&this._root.appendChild(e)}else if(this._selectedVendor)this.renderSelectedVendor();else{const e=this.createJoinTitle();if(this._root.appendChild(e),this._vendors&&this._vendors.length>0){this.createVendorList(this._vendors).map((e=>{this._root&&this._root.appendChild(e)}))}else{const e=this.createLoadingSpinner();this._root.appendChild(e)}}})),t(this,"createJoinDialog",(()=>{const e=document.createElement("dialog");e.style.fontFamily="Sen, sans-serif",e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.bottom="0",e.style.right="0",e.style.borderRadius="4px",e.style.height="600px",e.style.width="350px",e.style.maxHeight="600px",e.style.maxWidth="350px",e.style.margin="auto",e.style.backgroundColor="#fff",e.style.padding="1em",e.style.borderStyle="none",e.style.boxShadow="rgba(0, 0, 0, 0.2) 0px 2px 1px -1px, rgba(0, 0, 0, 0.14) 0px 1px 1px 0px, rgba(0, 0, 0, 0.12) 0px 1px 3px 0px",e.style.display="flex",e.style.flexDirection="column",e.style.alignItems="center";const t=document.querySelector("dialog::backdrop");return null==t||t.setAttribute("backdrop-filter","opacity(.2)"),e})),t(this,"_root",void 0),t(this,"renderAndOpenModal",(()=>{this._root=this.createJoinDialog(),document.body.appendChild(this._root),this._root.open||this._root.showModal()})),t(this,"open",(()=>{this.renderAndOpenModal(),this.renderJoinContents(),this.fetchVendorList().then((e=>{this._vendors=e,this._root&&this.renderJoinContents()}))})),t(this,"removeRoot",(()=>{this._root&&(this._root.open&&this._root.close(),document.body.removeChild(this._root))})),t(this,"close",(()=>{this.removeRoot(),this._onClose()})),this._onSuccess=i,this._onClose=s,this._sessionToken=e,this._derapiToken=o,this._derapiApiUrl=r,this._selectedVendor=void 0,this._vendors=void 0}}const s={createJoin:(e,t,n,s,o)=>{let r=o;r||(r="https://api.derapi.com");const l=new i(e,t,n,s,r);return{open:l.open,close:l.close}},fetchDerapiToken:async(e,t)=>{const n=new Headers;n.append("Authorization","Basic "+btoa(e+":"+t)),n.append("Content-Type","application/x-www-form-urlencoded");const i=await fetch("https://auth.derapi.com/oauth2/token".toString(),{method:"POST",headers:n,body:"grant_type=client_credentials"});return(await i.json()).access_token},createSession:async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"https://api.derapi.com";const i=new URL(n+"/join/session/start",n),s=new Headers;s.append("Authorization","Bearer ".concat(t)),s.append("Content-Type","application/json"),s.append("api-version","v2024-09-01");const o=await fetch(i.toString(),{method:"POST",headers:s,body:JSON.stringify(e)});return(await o.json()).sessionID}};export{s as default};
//# sourceMappingURL=bundle.esm.min.js.map

